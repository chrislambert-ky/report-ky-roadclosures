<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis by Mapping - KY Road Closures</title>
    <!-- My stylesheet for this page -->
    <link rel="stylesheet" href="../css/analysis_by_map.css">
    <!-- Required Leaflet CSS for mapping -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <!-- MarkerCluster plugin CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <!-- Required Leaflet JS for mapping -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- MarkerCluster plugin JS -->
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <nav class="main-nav">
        <a class="nav-link" href="../index.html">Home</a>
        <a class="nav-link" href="analysis_by_count.html">Analysis by Count</a>
        <a class="nav-link" href="analysis_by_duration.html">Analysis by Duration</a>
        <a class="nav-link" href="analysis_by_map.html">Analysis by Mapping</a>
        <a class="nav-link" href="powerbi.html">Example Power BI Dashboard</a>
        <a class="nav-link" href="about.html">About</a>
    </nav>
    <div style="text-align: center;">
        <h1>Interactive Analysis of KY Road Closures: by Location</h1>
        <p>This page will provide analysis of road closures by location.</p>
    </div>
    <div style="text-align: center;">
      <div id="map" style="width: 800px; height: 600px; display: inline-block;"></div>
    </div>
<script>
// =============================
// Leaflet Map Initialization
// =============================
// This script sets up a Leaflet map, loads road closure data from a JSON file,
// and displays each closure as a marker using clustering for performance and usability.
// The clustering is handled by the Leaflet.markercluster plugin, which groups nearby markers.

// 1. Create the map and set the initial view to Kentucky
const map = L.map('map').setView([37.822295, -85.76819], 7); // Centered on Kentucky

// 2. Add OpenStreetMap tiles as the base map layer
const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

// 3. Create a marker cluster group to efficiently display thousands of points
const markers = L.markerClusterGroup();

// 4. Fetch the road closure data from the JSON file
fetch('../data/data_v4_final_roadclosures.json')
  .then(response => response.json())
  .then(data => {
    // Loop through each closure record in the dataset
    data.forEach(closure => {
      // Only add a marker if both latitude and longitude are present
      if (closure.latitude && closure.longitude) {
        // Create a marker for the closure location
        const marker = L.marker([
          parseFloat(closure.latitude),
          parseFloat(closure.longitude)
        ]);
        // Bind a popup to the marker with closure details
        marker.bindPopup(
          `<b>${closure.Road_Name || closure.Route || 'Unknown Road'}</b><br>
           ${closure.Comments || ''}<br>
           <b>County:</b> ${closure.County_Name || ''}<br>
           <b>Reported:</b> ${closure.Reported_On || ''}<br>
           <b>Duration (hrs):</b> ${closure.Duration_Hours || ''}`
        );
        // Add the marker to the cluster group
        markers.addLayer(marker);
      }
    });
    // Add the cluster group to the map
    map.addLayer(markers);
  })
  .catch(error => {
    // Log any errors that occur during fetch or processing
    console.error('Error fetching or displaying road closures data:', error);
  });
// =============================
// End of Map Script
// =============================
</script>




</body>
</html>