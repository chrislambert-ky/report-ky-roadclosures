<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis by Mapping - KY Road Closures</title>
    <!-- My stylesheet for this page -->
    <link rel="stylesheet" href="../css/analysis_by_map.css">
    <!-- Required Leaflet CSS for mapping -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <!-- MarkerCluster plugin CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <!-- Required Leaflet JS for mapping -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- MarkerCluster plugin JS -->
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
</head>
<body>
    <nav class="main-nav">
        <a class="nav-link" href="../index.html">Home</a>
        <a class="nav-link" href="analysis_by_count.html">Analysis by Count</a>
        <a class="nav-link" href="analysis_by_duration.html">Analysis by Duration</a>
        <a class="nav-link" href="analysis_by_map.html">Map View</a>
        <a class="nav-link" href="analysis_by_table.html">Table View</a>
        <a class="nav-link" href="powerbi.html">Power BI Dashboard</a>
        <a class="nav-link" href="about.html">About</a>
    </nav>
    <div style="text-align: center;">
        <h1>Interactive Analysis of KY Road Closures: by Location</h1>
        <h2>Refreshes daily 12:30am EST</h2>
    </div>
    <div style="text-align: center;">
      <div id="map" style="width: 800px; height: 600px; display: inline-block;"></div>
    </div>
<script>

// Leaflet Map
// =============================
// The following Leaflet map is based on their Quick Start example.
// I just had to fetch my data and start customizing the content.
// The performance was horrible with 10,000+ markers, so I used the Leaflet.markercluster plugin.
// They have a lot of documentation at: https://leafletjs.com/reference.html
// Clustering docs can be found here: https://github.com/Leaflet/Leaflet.markercluster


// Create the map and set the initial view to Kentucky
const map = L.map('map').setView([37.822295, -85.76819], 7); // Centered on Kentucky

// Add OpenStreetMap tiles as the base map layer (example default)
const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
}).addTo(map);

// Create a marker cluster group to efficiently display thousands of points
const markers = L.markerClusterGroup({
    maxClusterRadius: 60, // default is 80, lower = tighter clusters
    disableClusteringAtZoom: 12 // clusters disappear at zoom 12
});
// 4. Fetch the road closure data from the JSON file
fetch('../data/data_v4_final_roadclosures.json')
  .then(response => response.json())
  .then(data => {
    // Loop through each closure record in the dataset
    data.forEach(closure => {
      // Look for laitude and longitude fields in the closure record
      if (closure.latitude && closure.longitude) {
        // Create a marker for the closure location
        const marker = L.marker([
          parseFloat(closure.latitude),
          parseFloat(closure.longitude)
        ]);
        // Popup settings
        marker.bindPopup(
          `<b>${closure.Road_Name || closure.Route || 'Unknown Road'}</b><br>
           ${closure.Comments || ''}<br>
           <b>County:</b> ${closure.County_Name || ''}<br>
           <b>Reported:</b> ${closure.Reported_On || ''}<br>
           <b>Duration (hrs):</b> ${closure.Duration_Hours || ''}`
        );
        // Add the marker to the cluster group
        markers.addLayer(marker);
      }
    });
    // Add the cluster group to the map
    map.addLayer(markers);
  })
  .catch(error => {
    // Log any errors that occur during fetch or processing
    console.error('Error fetching or displaying road closures data:', error);
  });

</script>




</body>
</html>