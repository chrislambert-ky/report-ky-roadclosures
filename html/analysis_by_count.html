<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-468B94S87K"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-468B94S87K');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis of KY Road Closures: Count</title>
    <link rel="stylesheet" href="../css/apache-viz.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <nav class="main-nav">
        <a class="nav-link" href="../index.html">Home</a>
        <a class="nav-link" href="analysis_by_count.html">Analysis by Count</a>
        <a class="nav-link" href="analysis_by_duration.html">Analysis by Duration</a>
        <a class="nav-link" href="analysis_by_map.html">Map View</a>
        <a class="nav-link" href="analysis_by_table.html">Table View</a>
        <a class="nav-link" href="powerbi.html">Power BI Dashboard</a>
        <a class="nav-link" href="about.html">About</a>
    </nav>
    <div style="text-align: center;">
        <h1>Interactive Analysis of KY Road Closures: by Count of Road Closures</h1>
        <h2>This page will provide analysis of road closures by count.</h2>
        <h2>Data refreshes daily 12:30am EST</h2>
    </div>

<div style="text-align:center;margin-bottom:1.5rem;">
  <button id="resetFilterBtn" style="background:#E0E1E1;color:#003764;font-weight:bold;border:none;padding:0.6em 1.5em;border-radius:6px;cursor:pointer;font-size:1.1em;box-shadow:0 2px 8px rgba(0,0,0,0.04);transition:background 0.2s;">Reset Filter</button>
</div>
<div class="diagram-grid">
  <div class="chart-container">
    <div id="main" style="width:100%;height:100%;"></div>
  </div>
  <div class="chart-container">
    <div id="monthChart" style="width:100%;height:100%;"></div>
  </div>
</div>
<script>
var chartDom = document.getElementById('main');
var myChart = echarts.init(chartDom);
var monthDom = document.getElementById('monthChart');
var monthChart = echarts.init(monthDom);
var resetBtn = document.getElementById('resetFilterBtn');

let rawData = [];
let selectedYear = null;
let selectedMonth = null;

const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

function renderCharts() {
  let filteredData = rawData;
  if (selectedYear !== null) {
    filteredData = filteredData.filter(closure => new Date(closure.Reported_On).getFullYear() === selectedYear);
  }
  if (selectedMonth !== null) {
    filteredData = filteredData.filter(closure => new Date(closure.Reported_On).getMonth() === selectedMonth);
  }

  // Year chart
  const yearCounts = {};
  filteredData.forEach(closure => {
    const year = new Date(closure.Reported_On).getFullYear();
    yearCounts[year] = (yearCounts[year] || 0) + 1;
  });
  const years = Object.keys(yearCounts).sort();
  const counts = years.map(year => yearCounts[year]);
  const yearOption = {
    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
    grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
    xAxis: { type: 'category', data: years, axisTick: { alignWithLabel: true } },
    yAxis: { type: 'value' },
    series: [{ name: 'Road Closures', type: 'bar', barWidth: '60%', data: counts,
      itemStyle: {
        color: function(params) {
          if (selectedYear !== null && years[params.dataIndex] == selectedYear) return '#5EB3E4';
          return '#003764';
        }
      }
    }]
  };
  myChart.setOption(yearOption);

  // Month chart
  const monthCounts = Array(12).fill(0);
  filteredData.forEach(closure => {
    const month = new Date(closure.Reported_On).getMonth();
    monthCounts[month]++;
  });
  const monthOption = {
    tooltip: { trigger: 'axis', axisPointer: { type: 'shadow' } },
    grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
    xAxis: { type: 'category', data: monthNames, axisTick: { alignWithLabel: true } },
    yAxis: { type: 'value' },
    series: [{ name: 'Closures by Month', type: 'bar', barWidth: '60%', data: monthCounts,
      itemStyle: {
        color: function(params) {
          if (selectedMonth !== null && params.dataIndex === selectedMonth) return '#5EB3E4';
          return '#003764';
        }
      }
    }]
  };
  monthChart.setOption(monthOption);
}

fetch('../data/data_v4_final_roadclosures.json')
  .then(response => response.json())
  .then(data => {
    rawData = data;
    renderCharts();
  });

myChart.on('click', function(params) {
  if (params.componentType === 'series') {
    const year = parseInt(params.name);
    if (selectedYear === year) {
      selectedYear = null;
    } else {
      selectedYear = year;
    }
    selectedMonth = null;
    renderCharts();
  }
});

monthChart.on('click', function(params) {
  if (params.componentType === 'series') {
    const monthIdx = params.dataIndex;
    if (selectedMonth === monthIdx) {
      selectedMonth = null;
    } else {
      selectedMonth = monthIdx;
    }
    selectedYear = null;
    renderCharts();
  }
});

resetBtn.addEventListener('click', function() {
  selectedYear = null;
  selectedMonth = null;
  renderCharts();
});
</script>

</body>
</html>
